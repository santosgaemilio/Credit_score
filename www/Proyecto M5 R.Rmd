---
title: "Análisis crediticio"
author: "Team 6"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Información general:

Este conjunto de datos proporciona una descripción completa de los perfiles de los posibles solicitantes de préstamos, específicamente diseñada para la demografía india. Encapsula una variedad de características, desde datos demográficos básicos hasta detalles financieros, que pueden ser fundamentales para evaluar la solvencia de un individuo.

Entendamos cada una de las variables:

-   **Age**: Representa la edad del solicitante. Indica el nivel de madurez del solicitante.

-   **Gender**: Género del solicitante.

-   **Income**: Los ingresos del solicitante, que son fundamentales para evaluar su capacidad para pagar el préstamo.

-   **Credit Score**: Puntuación que cuantifica la solvencia del solicitante en función de su historial crediticio. Basado en el modelo FICO.

-   **Credit History Length**: Representa el número de meses desde la primera línea de crédito del solicitante. Indica la experiencia del solicitante en la gestión de crédito.

-   **Number of Existing Loans**: El número de préstamos que tiene actualmente el solicitante.

-   **Loan Amount**: La cantidad de dinero que solicita el solicitante

-   **Loan Tenure**: El número de meses que el solicitante desea pagar el préstamo.

-   Existing Customer: Si el solicitante es un cliente existente de la compañía financiera.

-   State: El estado de la India donde reside el solicitante.

-   City: La ciudad o pueblo de la India donde reside el solicitante.

-   TV Ratio: La relación préstamo-valor representa la relación entre el monto del préstamo y el valor de tasación del activo (normalmente una casa). Los LTV más altos pueden indicar un mayor riesgo.

-   Employment Profile: Categoría laboral general del solicitante.

-   Occupation: Ocupación específica o puesto de trabajo del solicitante.

-   Profile Score: Una puntuación que oscila entre 0 y 100 representa el perfil general del solicitante en función de los datos reales de pago del préstamo. Los valores más altos indican mejores perfiles.

## Importamos las bibliotecas necesarias para el projecto

```{r message=FALSE, warning=FALSE, paged.print=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(dplyr)
library(reshape2)
library(corrplot)
library(factoextra)

```

## Importamos el dataset

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
data <- read_csv("./credit_data.csv")
```

```{r}
head(data)
```

Visualizamos las primeras filas de un conjunto de datos. Esto es útil por varias razones:

-Inspección Inicial

-Verificación de Carga Correcta

-Identificación de Patrones o Anomalías

-Comprobación de Tipos de Datos

-Planificación de Limpieza y Preprocesamiento

```{r}
summary(data)
```

```{r}
str(data)
```

Proporcionamos una vista general a los estadísticos y tipos de datos.

## Datos nulos

Comenzamos la busqueda de los datos faltantes.

```{r}
sum(is.na(data))
```

Encontramos directamente la variable en la que se encuentran y hacemos una imputación da do a que, podemos crear una categoría más con ella.

```{r}
colSums(is.na(data))
```

```{r}
unique_values <- unique(data$Occupation)
print(unique_values)
```

```{r}
data <- data %>%
  mutate(Occupation = ifelse(is.na(Occupation), "unknown", Occupation))
```

```{r}
colSums(is.na(data))
```

Al revisar nuevamente podemos corroborar que se ha realizado con éxito.

```{r}
sum(is.na(data))
```

## Análisis univariado

## Variables cualitativas

```{r}
ggplot(data, aes(x = Gender)) + 
  geom_bar(fill = "blue", color = "black") +
  theme_minimal() +
  labs(title = "Distribución de Género", x = "Género", y = "Frecuencia")
```

```{r}
#cliente existente
ggplot(data, aes(x = `Existing Customer`)) + 
  geom_bar(fill = "green", color = "black") +
  theme_minimal() +
  labs(title = "Distribución de Clientes Existentes", x = "Cliente Existente", y = "Frecuencia")
```

```{r}
#estado
ggplot(data, aes(x = State)) + 
  geom_bar(fill = "purple", color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Distribución por Estado", x = "Estado", y = "Frecuencia")

```

```{r}
#ciudad
ggplot(data, aes(x = City)) + 
  geom_bar(fill = "orange", color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Distribución por Ciudad", x = "Ciudad", y = "Frecuencia")
```

```{r}
#perfil laboral

ggplot(data, aes(x = `Employment Profile`)) + 
  geom_bar(fill = "red", color = "black") +
  theme_minimal() +
  labs(title = "Distribución de Perfil Laboral", x = "Perfil Laboral", y = "Frecuencia")
```

```{r}
#ocupacion
ggplot(data, aes(x = Occupation)) + 
  geom_bar(fill = "cyan", color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Distribución de Ocupaciones", x = "Ocupación", y = "Frecuencia")
```

### Variables cuantitativas

```{r}
ggplot(data, aes(x = Age)) + 
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  theme_minimal() + 
  labs(title = "Distribución de Edades", x = "Edad", y = "Frecuencia")

```

```{r}
ggplot(data, aes(y = Age)) + 
  geom_boxplot(fill = "blue", color = "black") +
  labs(title = "Diagrama de Caja de la Edad", y = "Edad")
```

```{r}
ggplot(data, aes(x = Income)) + 
  geom_histogram(bins = 30, fill = "green", color = "black") +
  labs(title = "Distribución de Ingresos", x = "Ingresos", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = Income)) + 
  geom_boxplot(fill = "green", color = "black") +
  labs(title = "Diagrama de Caja de Ingresos", y = "Ingresos")
```

```{r}
ggplot(data, aes(x = `Credit Score`)) + 
  geom_histogram(bins = 30, fill = "red", color = "black") +
  labs(title = "Distribución de la Puntuación de Crédito", x = "Puntuación de Crédito", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = `Credit Score`)) + 
  geom_boxplot(fill = "red", color = "black") +
  labs(title = "Diagrama de Caja de la Puntuación de Crédito", y = "Puntuación de Crédito")
```

```{r}
ggplot(data, aes(x = `Credit History Length`)) + 
  geom_histogram(bins = 50, fill = "purple", color = "black") +
  labs(title = "Distribución de la Longitud del Historial de Crédito", x = "Longitud del Historial de Crédito", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = `Credit History Length`)) + 
  geom_boxplot(fill = "purple", color = "black") +
  labs(title = "Diagrama de Caja de la Longitud del Historial de Crédito", y = "Longitud del Historial de Crédito")
```

```{r}
ggplot(data, aes(x = `Number of Existing Loans`)) + 
  geom_histogram(bins = 10, fill = "cyan", color = "black") +
  labs(title = "Distribución del Número de Préstamos Existentes", x = "Número de Préstamos Existentes", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = `Number of Existing Loans`)) + 
  geom_boxplot(fill = "cyan", color = "black") +
  labs(title = "Diagrama de Caja del Número de Préstamos Existentes", y = "Número de Préstamos Existentes")
```

```{r}
ggplot(data, aes(x = `Loan Amount`)) + 
  geom_histogram(bins = 30, fill = "orange", color = "black") +
  labs(title = "Distribución del Monto del Préstamo", x = "Monto del Préstamo", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = `Loan Amount`)) + 
  geom_boxplot(fill = "orange", color = "black") +
  labs(title = "Diagrama de Caja del Monto del Préstamo", y = "Monto del Préstamo")
```

```{r}
ggplot(data, aes(x = `Loan Tenure`)) + 
  geom_histogram(bins = 30, fill = "magenta", color = "black") +
  labs(title = "Distribución de la Duración del Préstamo", x = "Duración del Préstamo", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = `Loan Tenure`)) + 
  geom_boxplot(fill = "magenta", color = "black") +
  labs(title = "Diagrama de Caja de la Duración del Préstamo", y = "Duración del Préstamo")
```

```{r}
ggplot(data, aes(x = `LTV Ratio`)) + 
  geom_histogram(bins = 30, fill = "lightblue", color = "black") +
  labs(title = "Distribución de la Relación Préstamo-Valor", x = "Relación Préstamo-Valor", y = "Frecuencia")

```

```{r}
ggplot(data, aes(y = `LTV Ratio`)) + 
  geom_boxplot(fill = "lightblue", color = "black") +
  labs(title = "Diagrama de Caja de la Relación Préstamo-Valor", y = "Relación Préstamo-Valor")
```

```{r}
ggplot(data, aes(x = `Profile Score`)) + 
  geom_histogram(bins = 30, fill = "lightgreen", color = "black") +
  labs(title = "Distribución de la Puntuación de Perfil", x = "Puntuación de Perfil", y = "Frecuencia")
```

```{r}
ggplot(data, aes(y = `Profile Score`)) + 
  geom_boxplot(fill = "lightgreen", color = "black") +
  labs(title = "Diagrama de Caja de la Puntuación de Perfil", y = "Puntuación de Perfil")
```

## Conclusión análisis univariado

Proporcionamos un resumen de los tipos de datos que tenemos junto con algunas caracteristicas generales. Se ofrece una visión estadística detallada de cada columna en tu conjunto de datos.

-Edad (Age): Varía entre 18 y 70 años, con una mediana y media alrededor de los 44 años. Esto indica una distribución relativamente uniforme de edades en el conjunto de datos.

-Género (Gender): Es una variable categórica (texto), pero el resumen no proporciona detalles sobre las categorías específicas.

-Ingresos (Income): Oscilan entre \$9,000 y \$209,000, con una media de aproximadamente \$76,499. Esto sugiere una amplia gama de ingresos entre los individuos del conjunto de datos.

-Puntuación de Crédito (Credit Score): Varía de 300 a 850, lo que es típico para las puntuaciones de crédito. La mediana es de 584, indicando que la mitad de las puntuaciones está por debajo de 584 y la otra mitad por encima.

-Longitud del Historial de Crédito (Credit History Length): Va de 6 a 611 (probablemente meses), lo que muestra que algunos individuos tienen un historial de crédito muy corto, mientras que otros tienen un historial muy largo.

-Número de Préstamos Existentes (Number of Existing Loans): Los individuos tienen entre 0 y 10 préstamos existentes, con una media cercana a 5.

-Monto del Préstamo (Loan Amount): Varía entre \$5,294 y \$150,000, con una mediana de \$111,263, lo que sugiere que la mayoría de los préstamos son de cantidades significativas.

-Duración del Préstamo (Loan Tenure): Va de 12 a 359, posiblemente en meses, indicando una amplia gama de duraciones de préstamo.

-Cliente Existente (Existing Customer): Es una variable categórica, pero el resumen no detalla cuántos son clientes existentes y cuántos no.

-Estado (State) y Ciudad (City): Son variables categóricas, pero el resumen no especifica cuáles estados o ciudades están incluidos.

-Relación Préstamo-Valor (LTV Ratio): Varía entre 40% y 95%, con una mediana de 72.13%. Esto puede indicar el porcentaje del valor de un activo que está siendo financiado.

-Perfil de Empleo (Employment Profile): Es categórico, pero no se detallan las categorías específicas.

-Puntuación de Perfil (Profile Score): Va de 0 a 100, con una mediana de 89, lo que podría ser una medida de la idoneidad o calidad del perfil del cliente.

-Ocupación (Occupation): También es categórica, pero no se detallan las ocupaciones específicas.

## Analisis Bivariado

Una vez realizado el análisis variable por variable, vamos en busca de una relación entre ellas.

```{r}
data_numeric <- select(data, Age, Income, `Credit Score`, `Credit History Length`, `Number of Existing Loans`, `Loan Amount`, `Loan Tenure`, `LTV Ratio`, `Profile Score`)
cor_matrix <- cor(data_numeric, use = "complete.obs")
```

```{r}
cor_matrix_melted <- melt(cor_matrix)
ggplot(cor_matrix_melted, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0) +
  theme_minimal() +
  coord_fixed()
```

Revisamos las relaciones que puedan existir entre las variables.

```{r}
corrplot(cor_matrix, method = "color")
```

Mejoramos el formato y buscamos factores importantes. y visualizamos relaciones mas a detalle.

Consideramos 5 importantes:

```{r}
#income & credit score
ggplot(data, aes(x = Income, y = `Credit Score`)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Relación entre Ingresos y Puntuación de Crédito", x = "Ingresos", y = "Puntuación de Crédito")

cor(data$Income, data$`Credit Score`, use = "complete.obs")

```

```{r}
# age & existing loans
ggplot(data, aes(x = Age, y = `Number of Existing Loans`)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "blue") +
  labs(title = "Relación entre Edad y Número de Préstamos Existentes", x = "Edad", y = "Número de Préstamos Existentes")

cor(data$Age, data$`Number of Existing Loans`, use = "complete.obs")
```

```{r}
#loan amount $ loan tenure
ggplot(data, aes(x = `Loan Amount`, y = `Loan Tenure`)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "green") +
  labs(title = "Relación entre Monto del Préstamo y Duración del Préstamo", x = "Monto del Préstamo", y = "Duración del Préstamo")

cor(data$`Loan Amount`, data$`Loan Tenure`, use = "complete.obs")
```

```{r}
#profile score & credit score

ggplot(data, aes(x = `Profile Score`, y = `Credit Score`)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "purple") +
  labs(title = "Relación entre Puntuación de Perfil y Puntuación de Crédito", x = "Puntuación de Perfil", y = "Puntuación de Crédito")

cor(data$`Profile Score`, data$`Credit Score`, use = "complete.obs")
```

```{r}
#LTV Ratio % Profile Score
ggplot(data, aes(x = `LTV Ratio`, y = `Profile Score`)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "green") +
  labs(title = "Relación entre el préstamo-valor y la puntuación de perfil", x = "Préstamo valor", y = "Puntuación de perfil")

cor(data$`LTV Ratio`, data$`Profile Score`, use = "complete.obs")
```

## Conclusón del análisis bivariado

-Relación entre Ingresos y Puntuación de Crédito: *Interpretación: Una relación positiva podría indicar que individuos con mayores ingresos tienden a tener mejores puntuaciones de crédito. Esto podría deberse a una mayor capacidad para manejar deudas y pagos a tiempo.* Implicaciones: Esta relación puede ser útil para las instituciones financieras para evaluar la solvencia de los solicitantes de crédito.

-Relación entre Edad y Número de Préstamos Existentes: *Interpretación: Hay una tendencia de que las personas mayores tienen más préstamos, esto podría reflejar un aumento en la necesidad o capacidad de endeudamiento a lo largo de la vida.* Implicaciones: Podría ayudar a entender mejor cómo las necesidades financieras cambian con la edad.

-Relación entre Monto del Préstamo y Duración del Préstamo:

*Interpretación: Una correlación quizá un poco baja pero, sugiere que los préstamos más grandes tienden a tener plazos más largos, lo cual es lógico desde el punto de vista de la capacidad de pago.* Implicaciones: Esto puede influir en cómo las entidades crediticias estructuran los términos del préstamo en función de su monto.

-Relación entre Puntuación de Perfil y Puntuación de Crédito:

*Interpretación: Aquí hay una fuerte relación entre estas dos variables, lo cual indica que la puntuación de perfil, que podría incluir factores como estabilidad laboral o historial financiero, es un buen indicador de la puntuación de crédito.* Implicaciones: Esto puede ser valioso para desarrollar modelos predictivos de riesgo crediticio.

-Relación entre Préstamo-Valor (LTV) y Puntuación de Perfil:

*Interpretación: Existe una relación significativa, auqne es negativa, podría sugerir que las personas con perfiles más fuertes tienden a tener ratios de préstamo-valor más bajos.* Implicaciones: Esto podría informar las decisiones sobre la concesión de préstamos, especialmente en préstamos garantizados como hipotecas.

## Multivariado

Una vez encongrados los hallazgos y respuestas a preguntas generadas por el análisis bivariado, podemos comprobar ciertos valores.

```{r}
#regresion lineal multiple
data_model <- select(data, `Credit Score`, Income, Age, `Number of Existing Loans`, `Credit History Length`, `Loan Amount`, `Loan Tenure`, `LTV Ratio`)

data_model <- na.omit(data_model)

model <- lm(`Credit Score` ~ ., data = data_model)
summary(model)

```

La regresión nos muestra un buen resultado, hay correlacion entre las variables, a pesar de que el MSE no es el mejor, el R2 nos dice que el modelo funciona se adapta de manera muy favorable. Está mostrando cómo ciertas características como los ingresos, la cantidad de préstamos existentes, la duración del préstamo, y otros factores están relacionados con la puntuación de crédito de una persona. Algunas de estas características tienen una influencia significativa en la puntuación de crédito, mientras que otras no parecen ser tan relevantes. Para las características significativas, el modelo indica si tienden a aumentar o disminuir la puntuación de crédito cuando cambian. El modelo explica una gran parte de las variaciones en las puntuaciones de crédito, lo que sugiere que es bastante preciso en los datos actuales.

```{r}
#modelo logistico a partir de profile score

umbral <- median(data$`Profile Score`, na.rm = TRUE)

data$CategoriaBinaria <- ifelse(data$`Profile Score` >= umbral, 1, 0)  # 1 para 'Alto', 0 para 'Bajo'

table(data$CategoriaBinaria)

data_logistic <- select(data, `CategoriaBinaria`, Income, Age, `Credit Score`, `Loan Amount`, `Loan Tenure`, `LTV Ratio`)

data_logistic <- na.omit(data_logistic)

logistic_model <- glm(`CategoriaBinaria` ~ ., data = data_logistic, family = "binomial")

summary(logistic_model)
```

Como lo sugería el análisis bivariado, se puede predecir la variable Profile Score. Utilizamos una regresión logistica, añadiendo además de Credit Score, otras variables con las que tiene relación. El modelo se ajusta bastante bien, podemos ver en el resumen que se adapta a la mayoría de los datos, dandonos como resultado: Que el 0 indica una posibilidad baja mientras el 1 nos sugiere una probabilidad alta.

```{r}
#analisis de clusteres

data_cluster <- select(data, Income, Age, `Credit Score`, `Number of Existing Loans`, `Loan Amount`)

data_cluster <- na.omit(data_cluster)

data_cluster_scaled <- scale(data_cluster)

set.seed(123) 
kmeans_result <- kmeans(data_cluster_scaled, centers = 4, nstart = 25)

fviz_cluster(kmeans_result, data = data_cluster_scaled)

```

```{r}
# Añadir la asignación del clúster al conjunto de datos original
data$Cluster <- kmeans_result$cluster
# Calcular estadísticas descriptivas para cada clúster
cluster_summary <- data %>%
  group_by(Cluster) %>%
  summarise(
    Income_Mean = mean(Income, na.rm = TRUE),
    Age_Mean = mean(Age, na.rm = TRUE),
    Credit_Score_Mean = mean(`Credit Score`, na.rm = TRUE),
    Existing_Loans_Count = mean(`Number of Existing Loans`, na.rm = TRUE),
    Loan_Amount_Mean = mean(`Loan Amount`, na.rm = TRUE),
    Loan_Tenure_Mean = mean(`Loan Tenure`, na.rm = TRUE),
    LTV_Ratio_Mean = mean(`LTV Ratio`, na.rm = TRUE),
    Count = n()
  )
```

```{r}
cluster_summary
```

Tratamos de encontrar ahora más resultados para nuestro análisis y encontramos que tenemos bastante bien equilibrados 4 tipos de solicitantes:

-Cluster 1 - "Ingresos Altos, Puntuación de Crédito Baja": Este grupo podría representar a individuos que han tenido una vida laboral extensa y exitosa, reflejada en sus ingresos altos y edad mayor, pero que tal vez han tenido dificultades financieras recientes o decisiones de préstamos no óptimas que afectaron su puntuación de crédito. Estrategia Potencial: Ofrecer servicios de asesoramiento financiero o productos de crédito con tasas preferenciales que incentiven la mejora de la puntuación de crédito.

-Cluster 2 - "Jóvenes con Menor Capacidad Crediticia": Este clúster podría consistir en jóvenes profesionales en las etapas iniciales de su carrera con ingresos relativamente bajos y puntuaciones de crédito en desarrollo. Estrategia Potencial: Proporcionar productos crediticios diseñados para principiantes, como tarjetas de crédito con límites bajos o préstamos con garantías, y ofrecer educación financiera para fomentar la responsabilidad crediticia.

-Cluster 3 - "Jóvenes con Buena Salud Crediticia": Estos individuos podrían ser más jóvenes, posiblemente en la mitad de su carrera, con ingresos moderados y excelentes puntuaciones de crédito, lo que indica un manejo financiero prudente. Estrategia Potencial: Ofrecer productos de inversión o ahorro, y oportunidades de crédito con tasas de interés competitivas para mantener su lealtad y apoyar sus objetivos financieros a largo plazo.

-Cluster 4 - "Acomodados y Financieramente Seguros": Este grupo parece tener individuos de edad avanzada con ingresos muy altos y puntuaciones de crédito superiores, lo que sugiere una estabilidad financiera considerable y un buen manejo de deudas y créditos. Estrategia Potencial: Enfocarse en productos de alto valor como inversiones, gestión de patrimonio o servicios de jubilación, y ofrecer servicios personalizados que se alineen con su capacidad financiera y necesidades de planificación a largo plazo.

# Conclusión General

A través de un análisis exhaustivo que combinó métodos estadísticos y de aprendizaje automático, exploramos las complejidades de un conjunto de datos de crédito para descubrir insights sobre el comportamiento financiero y la solvencia crediticia. Iniciamos con un análisis de variable por variable, hasta llegar con regresiones lineales y logísticas para entender las relaciones y los predictores de la puntuación de crédito y la clasificación de perfiles de riesgo. Posteriormente, implementaste un análisis de clúster para segmentar los individuos en grupos distintos según sus atributos financieros.

Los resultados del análisis de regresión identificaron variables clave que influyen en la puntuación de crédito y la probabilidad de tener una alta puntuación de perfil, proporcionando una comprensión detallada de los factores que contribuyen a un perfil de crédito favorable. Con la técnica de clúster, descubriste agrupaciones naturales en los datos, lo que sugiere patrones de comportamiento financiero distintos y ofrece una base para estrategias de marketing dirigidas y la personalización de productos y servicios financieros.

En conjunto, este análisis del conjunto de datos de crédito reveló una variedad de comportamientos y características financieras, destacando la importancia de un enfoque personalizado en la gestión financiera y el desarrollo de productos. Este entendimiento podría ser utilizado por instituciones financieras para mejorar la toma de decisiones crediticias, optimizar estrategias de riesgo y fortalecer las relaciones con los clientes mediante la oferta de soluciones que se alineen con sus necesidades y perfiles financieros específicos.
